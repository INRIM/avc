<!DOCTYPE html>
<html><head>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The Python Property Builtin</title>

<link rel="stylesheet" type="text/css" href="The%20Python%20Property%20Builtin_files/agdj-complete.css">


<script type="text/javascript" src="The%20Python%20Property%20Builtin_files/jquery.js"></script>
<script type="text/javascript" src="The%20Python%20Property%20Builtin_files/agdj.js"></script>





<link rel="alternate" title="Adam Gomaa's Blog Feed" href="http://adam.gomaa.us/blog/feed/" type="application/rss+xml">


<link rel="icon" type="image/gif" href="http://gomaa.us/images/ag_logo.png"></head><body>

  <h1>
    <a href="http://adam.gomaa.us/blog/">blog:</a>
    <a href="http://adam.gomaa.us/blog/the-python-property-builtin/">The Python Property Builtin</a></h1>

<div id="metadata">
  
<p class="timestamp">
  <a href="http://adam.gomaa.us/">posted
    <span title="2008-08-11T13:48:40Z" class="iso8601">2 months ago</span></a></p>
<div class="tag-container">tagged: 

<ul class="tags">

<li><a href="http://adam.gomaa.us/blog/tag/python/">python</a></li>

</ul>


</div>

</div>
<div id="content">
  

<div class="post-content">
<p>So I'm going to start writing every day. Hold me to that, please.</p>

<p>Today I'm writing about one little corner of Python, the <a href="http://www.python.org/download/releases/2.2/descrintro/#property">property
function</a>. It's a builtin function, around since at least
2.2.</p>

<p>I used a question that involved <code>property</code> as one of the
interview questions during a recent developer search, and I found
about a 50-50 split of people who knew about it, and those who didn't,
and without much correlation to how much Python experience the
developer had. So I think it's one of those things that you only
really use if you know about it - it's by no means essential, and you
can go your whole Python career not knowing about it, but, well, as
toolboxes go, this is a pretty nifty screwdriver.</p>

<p>I'm going to show basic usage, and then a couple ways to abuse it.</p>

<h3>Basic Usage</h3>

<div class="codehilite"><pre><code></code><ol><li><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</li><li>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">):</span>
</li><li>
</li><li>        <span class="c"># pretty straightforward initialization, just set a couple</span>
</li><li>        <span class="c"># attributes</span>
</li><li>        <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">first_name</span>
</li><li>        <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">last_name</span>
</li><li>
</li><li>    <span class="k">def</span> <span class="nf">get_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="s">"</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</li><li>
</li><li>    <span class="n">full_name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_full_name</span><span class="p">)</span>
</li></ol></pre></div>

<p>And how it works in an interactive session:</p>

<pre><code>&gt;&gt;&gt; me = Person("Adam", "Gomaa")
&gt;&gt;&gt; me.get_full_name()
'Adam Gomaa'
&gt;&gt;&gt; me.full_name
'Adam Gomaa'
</code></pre>

<p>Note the lack of parens on the last input line; despite the lack of an
explicit call, <code>get_full_name</code> apparently got called anyway!</p>

<p>This is what the <code>property</code> builtin does: it allows you to
set getters and setters under some name on instances of the class. I
only did a getter in this case, but setters are also possible as the
optional second argument:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</li><li>    <span class="c"># ...</span>
</li><li>
</li><li>    <span class="k">def</span> <span class="nf">get_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="s">"</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</li><li>
</li><li>    <span class="k">def</span> <span class="nf">set_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_name</span><span class="p">):</span>
</li><li>        <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</li><li>
</li><li>    <span class="n">full_name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_full_name</span><span class="p">,</span> <span class="n">set_full_name</span><span class="p">)</span>
</li></ol></pre></div>

<h3>Why?</h3>

<p>Now why would you want to do this? In many cases, it's because
something you used to have as an actual instance attribute (say,
<code>.url</code>) became a computed value, based on other instance
attributes. Now, you <em>could</em> update all your code to call
<code>.get_url()</code> instead, and write a <code>.set_url()</code>
if that's possible... or you could just turn <code>.url</code> into a
property.</p>

<p>Be sure, though, to set some ground rules for yourself. Remember,
you're simulating an attribute lookup, which, in Python, usually means
looking up a value in a dictionary based on a short string key - one
of the fastest, most-optimized pieces of Python. So, don't make your
property getter overly complex. In general, I'd say that it should
have one and only one code path - conditionals are acceptable, but
you're better off without them if you really want this to be a
leakless abstraction. And stay far, far away from anything that has
side effects in property getters - you'll drive yourself and other
programmers crazy.</p>

<p>(Don't worry, I'll break all these rules by the time I finish this
article.)</p>

<h3>Decorator Tricks</h3>

<p>The signature of <code>property</code> is:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fdel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</li></ol></pre></div>

<p>When you only need a getter - which is the most common use case - then
the relevant part becomes:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="nb">property</span><span class="p">(</span><span class="n">getter</span><span class="p">)</span>
</li></ol></pre></div>

<p>And so your code, inside your class is going to look something like:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="k">class</span> <span class="nc">MyObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</li><li>
</li><li>    <span class="k">def</span> <span class="nf">get_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">whatever</span>
</li><li>    <span class="n">something</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_something</span><span class="p">)</span>
</li></ol></pre></div>

<p>In fact, at that point, you don't really care about
<code>get_something</code>. We could even do something like:</p>

<div class="codehilite"><pre><code></code><ol><li>    <span class="k">def</span> <span class="nf">something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">whatever</span>
</li><li>    <span class="n">something</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">something</span><span class="p">)</span>
</li></ol></pre></div>

<p>Which, as long as you're using Python 2.4 or above, can be shorthanded
to:</p>

<div class="codehilite"><pre><code></code><ol><li>    <span class="nd">@property</span>
</li><li>    <span class="k">def</span> <span class="nf">something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">whatever</span>
</li></ol></pre></div>

<p>At that point, accessing <code>.something</code> will call this getter
function, without the parens. Be sure <em>not</em> to use
<code>.something()</code>, or you'll be calling whatever is returned
(helpfully named 'whatever' in the example above), and if it's not
callable, you'll get an exception.</p>

<h3>Defining Getter, Setter, and Deller in One</h3>

<p>Let's take an example adapted from <a href="http://code.activestate.com/recipes/410698/">one of the comments at ActiveState</a>:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="k">def</span> <span class="nf">Property</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</li><li>    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="o">**</span><span class="n">func</span><span class="p">())</span>
</li><li>
</li><li><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</li><li>    <span class="nd">@Property</span>
</li><li>    <span class="k">def</span> <span class="nf">name</span><span class="p">():</span>
</li><li>        <span class="n">doc</span> <span class="o">=</span> <span class="s">"The person's name"</span>
</li><li>
</li><li>        <span class="k">def</span> <span class="nf">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>            <span class="k">return</span> <span class="s">"</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</li><li>
</li><li>        <span class="k">def</span> <span class="nf">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</li><li>            <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</li><li>
</li><li>        <span class="k">def</span> <span class="nf">fdel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span>
</li><li>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span>
</li><li>
</li><li>        <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
</li></ol></pre></div>

<p>The advantage to this strategy is that it allows you to define all the
arguments to <code>property</code> without filling up the class's
namespace with <code>_get_foo</code>, <code>_set_foo</code>, and so
on.</p>

<p>The disadvantage is that you already have 3 levels of indentation in
your 'top-level' getter function code. I personally avoid it for this
reason. As noted before, though, most of the time you can get away
with not having a setter at all.</p>

<h3>Example: Django URLs</h3>

<p>For a long time, in the Django world, <code>.get_absolute_url()</code>
was the way you got URLs for
objects. <code>django.core.urlresolvers.reverse</code> has gained some
ground - and in terms of DRYness, is a better answer - but let me tell
you, <code>reverse("appname-modelname", args=[object.slug])</code> is
not so fun, particularly when you change that URL pattern name and
have to update a few dozen <code>{% url %}</code> tags. (sed and grep
help a lot with that, but many developers, myself included on most
days, don't have enough sed-fu to use it without the man page open).</p>

<p><code>.get_absolute_url()</code> has it's own set of problems. For
starters, it ties the model layer to the URL layer, kind of, sort of,
maybe. But <code>reverse()</code> is ugly because you have to remember
what the arguments are, what order they're in, and how you're supposed
to get the damned things anyway. If you're doing a RESTful,
hierarchy-oriented URL scheme, this can get ugly fast:</p>

<pre><code># to get '/books/a-midsummer-nights-dream/reviews/overall-nice-odd-grammar/update/':
review_update_url = reverse("books-review-update", args=[self.book.slug, self.slug])
</code></pre>

<p>And, there's no way of knowing that you need the book slug, as opposed
to the book id, unless you go look up the URLconf. And that'll
interrupt your flow, or you can just guess, and then you'll interrupt
your flow anyway to debug the <code>NoReverseMatch</code> that you just got.</p>

<p>Enter <code>property</code>. Who's really the authority on Review's
URLs? Well, technically, the URLconf. But in some ethereal sense,
shouldn't <code>Review</code> be arbitrating it's own URLs? That's
what <code>.get_absolute_url()</code> did, and it worked pretty well;
a considered, balanced 'denormalization' for the sake of convenience
at the expense of DRY.</p>

<p>Unfortunately, <code>get_absolute_url()</code> has its own problem (besides the
theoretical ones) - namely, there's only one of it. For each object,
typically, you'll have several URLs:</p>

<pre><code>/books/ - an index/list/search page
/books/new/ - A new submission form
/books/(regexp)/ - a view/update page
/books/(regexp)/delete/ - A delete/confirm delete page
/books/(regexp)/reviews/ - *another* index/list/search page
...
</code></pre>

<p>At first, <code>property</code> only makes this less painful:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
</li><li>
</li><li><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</li><li>    <span class="c"># for compatibility, I'm leaving .get_absolute_url()</span>
</li><li>    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">"books-view"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</li><li>    <span class="n">absolute_url</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_absolute_url</span><span class="p">)</span>
</li><li>
</li><li>    <span class="nd">@property</span>
</li><li>    <span class="k">def</span> <span class="nf">reviews_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">"books-reviews"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</li><li>
</li><li>    <span class="nd">@property</span>
</li><li>    <span class="k">def</span> <span class="nf">delete_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">"books-delete"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</li></ol></pre></div>

<p>But if you're paying attention, you'll see all these seem to follow
the same pattern:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="nd">@property</span>
</li><li><span class="k">def</span> <span class="nf">SOMETHING_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>    <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">"books-SOMETHING"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</li></ol></pre></div>

<p>If you can see where I'm going, now's probably the time to start
running away.</p>

<p>Now, duplicated code means "think about an abstraction." I'm about to
break the first rule I set, about not making properties overly
complex. In reality, a quick little method could do what I'm about to
show you in a much easier way:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="k">def</span> <span class="nf">object_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url_type</span><span class="p">):</span>
</li><li>    <span class="k">if</span> <span class="n">url_type</span> <span class="o">==</span> <span class="s">"reviews"</span><span class="p">:</span>
</li><li>        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="o">...</span>
</li><li>    <span class="k">elif</span> <span class="n">url_type</span> <span class="o">==</span> <span class="s">"delete"</span><span class="p">:</span> 
</li><li>        <span class="c"># .. and so on</span>
</li></ol></pre></div>

<p>But come on now, that wouldn't be very much fun, would it?</p>

<h3>Overly Complex Properties</h3>

<p>So instead, let's think about how we would want to define a named set
of urls for a single object. We could do it with multiple FOO_url
properties:</p>

<pre><code>book.absolute_url
book.reviews_url
book.delete_url
</code></pre>

<p>Or we could make a <code>.url</code> property with dictionary access:</p>

<pre><code>book.urls['absolute']
book.urls['reviews']
book.urls['delete']
</code></pre>

<p>Or heck, even with attribute access</p>

<pre><code>book.urls.absolute
book.urls.reviews
book.urls.delete
</code></pre>

<p>At that point, your view code for redirects becomes utterly wonderful:</p>

<pre><code>return HttpResponseRedirect(book.urls.reviews)
</code></pre>

<p>and so on. I just love that, because it's so astonishingly close to
what I'm trying to say: send them to the reviews page for this book.</p>

<p>I'm going to show the attribute access code, but you can pretty much
substitute for dictionary syntax by replacing <code>__getattr__</code>
with <code>__getitem__</code> in this code:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="k">def</span> <span class="nf">attrproperty</span><span class="p">(</span><span class="n">getter_function</span><span class="p">):</span>
</li><li>
</li><li>    <span class="k">class</span> <span class="nc">_Object</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</li><li>        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</li><li>            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
</li><li>        <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
</li><li>            <span class="k">return</span> <span class="n">getter_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</li><li>
</li><li>    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">_Object</span><span class="p">)</span>
</li></ol></pre></div>

<p>Of course, that's still rather indented, but at least its a library
function rather than something you're putting into your model
code. Usage looks something like this:</p>

<div class="codehilite"><pre><code></code><ol><li><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</li><li>
</li><li>    <span class="nd">@attrproperty</span>
</li><li>    <span class="k">def</span> <span class="nf">urls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</li><li>        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"absolute"</span><span class="p">:</span>
</li><li>            <span class="n">urlpattern_name</span> <span class="o">=</span> <span class="s">"books-view"</span>
</li><li>        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"reviews"</span><span class="p">:</span>
</li><li>            <span class="n">urlpattern_name</span> <span class="o">=</span> <span class="s">"books-reviews"</span>
</li><li>        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"delete"</span><span class="p">:</span>
</li><li>            <span class="n">urlpattern_name</span> <span class="o">=</span> <span class="s">"books-delete"</span>
</li><li>
</li><li>        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="n">urlpattern_name</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</li></ol></pre></div>

<p>Thus allowing <code>book.urls.whatever</code>. Dictionary syntax is
actually a little nicer, since you can more easily stick a variable in
there (<code>books.urls[action]</code>, for example) but I like the
look of attribute access.</p>

<p>Anyway, it's pretty obvious that this is a gross abuse of
property. But I'm not satisfied yet.</p>

<h3>Caching: Side-Effect Properties</h3>

<p>Let's go back to our <code>.FOO_url</code> properties from before. One
thing about <code>reverse()</code> calls is that if you have to
traverse intermediary models, building urls can be, well,
expensive. If Review #142 has to look up the slug of Book #21, it
probably has to load that object from the database (unless your PK is
also what you're using in the URL, but we can't count on that). That
can make rendering an HTML page, with dozens or hundreds of links and
<code>.FOO_url</code> accesses, kind of expensive.</p>

<p>But, of <em>course</em>, you're coding so those <a href="http://www.w3.org/Provider/Style/URI">URLs don't
change</a>, right?  So why recompute it each time? Just compute
it once for each object, and throw it into a cache.</p>

<div class="codehilite"><pre><code></code><ol><li><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
</li><li><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">cache</span>
</li><li>
</li><li><span class="k">def</span> <span class="nf">cached_property</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</li><li>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</li><li>    <span class="k">def</span> <span class="nf">_closure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="n">cache_key</span> <span class="o">=</span> <span class="s">"</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">)"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span>
</li><li>                                      <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
</li><li>                                      <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
</li><li>                                      <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</li><li>        <span class="n">val</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
</li><li>
</li><li>        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</li><li>            <span class="n">val</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</li><li>            <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</li><li>
</li><li>        <span class="k">return</span> <span class="n">val</span>
</li><li>
</li><li>    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</li></ol></pre></div>

<p>Throw that around your <code>.FOO_url</code> properties:</p>

<div class="codehilite"><pre><code></code><ol><li>    <span class="nd">@cached_property</span>
</li><li>    <span class="k">def</span> <span class="nf">reviews_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">"books-reviews"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</li><li>
</li><li>    <span class="nd">@cached_property</span>
</li><li>    <span class="k">def</span> <span class="nf">delete_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</li><li>        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">"books-delete"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">])</span>
</li></ol></pre></div>

<p>and now they'll only make DB calls the first time they're called, per
object that accessed on. That's certainly acceptable.</p>

<p>You could combine this with <code>@attrproperty</code> to get cached
<code>obj.urls.foo</code> access, but that will be left as an exercise
for the reader.</p>

<h3>Finally...</h3>

<p>That's about all I have for today. While researching this post I
looked into the Python descriptor protocol, which I might make the
subject of a future post.</p>

</div>
<div class="comments">
  <h3>Comments</h3>
  <p>174 spam comments omitted.</p>
  <form class="add nospam-me" action="" method="post">
    <fieldset>
      <legend>Add Comment</legend>
      <p>Comments can
        use <a href="http://daringfireball.net/projects/markdown/">Markdown</a>
        formatting. Raw HTML will be stripped.</p>
      <p><label for="id_name">Name:</label> <input name="name" id="id_name" type="text"></p>
<p><label for="id_url">Url:</label> <input name="url" id="id_url" type="text"></p>
<p><label for="id_text">Text:</label> <textarea id="id_text" rows="10" cols="40" name="text"></textarea></p>
      <input class="submit" value="Add Comment" type="submit">
    </fieldset>
  <input name="not_spam" value="indeed." type="hidden"></form>





<div class="comment" data-comment-id="5811">
  <header>

    </header><h5><a href="http://refragable.com/">David Montgomery</a></h5>

  <p class="time">#5811, <span title="2008-08-11T19:30:54Z" class="iso8601">6 hours later</span></p>
  
  <div class="comment-body"><p>In the "Defining Getter, Setter, and Deller in One" example, name is missing a "return locals()".</p>
</div>
</div>








<div class="comment" data-comment-id="5814">
  <header>

    </header><h5><a href="http://adam.gomaa.us/">Adam Gomaa</a></h5>

  <p class="time">#5814, <span title="2008-08-11T19:56:14Z" class="iso8601">6 hours later</span></p>
  
  <div class="comment-body"><p>It's there; you might have to scroll to see it.</p>
</div>
</div>








<div class="comment" data-comment-id="5825">
  <header>

    </header><h5><a href="http://ronny.uberhost.de/">Ronny Pfannschmidt</a></h5>

  <p class="time">#5825, <span title="2008-08-12T14:39:28Z" class="iso8601">25 hours later</span></p>
  
  <div class="comment-body"><p>your caching sucks</p>

<p>use a non-data descriptor</p>

<p>that way the instance slot of the <em>same</em> name will override the class sloth, thus not polluting the instance with weird attributes</p>
</div>
</div>








<div class="comment" data-comment-id="5826">
  <header>

    </header><h5><a href="http://whynoti.org/">Lucy</a></h5>

  <p class="time">#5826, <span title="2008-08-12T14:44:11Z" class="iso8601">25 hours later</span></p>
  
  <div class="comment-body"><p>cool. thx also for the "unifying types and classes" link , since that provides useful background.</p>
</div>
</div>








<div class="comment" data-comment-id="5827">
  <header>

    </header><h5><a href="http://adam.gomaa.us/">Adam Gomaa</a></h5>

  <p class="time">#5827, <span title="2008-08-12T17:02:46Z" class="iso8601">27 hours later</span></p>
  
  <div class="comment-body"><p>True enough, Ronny. That caching code <em>is</em>
Django-specific, not like non-data descriptions. But, it doesn't
pollute the class namespace - closure doesn't get captured in the class.</p>

<p>On the other hand, the advantage of using that over a non-data
descriptor is that non-data descriptors will run once per process per
object - whereas if you're using a one of the external-process cache
engines in Django (like memcached) then it's only once per object, no
matter how many processes you're running. Not a huge deal, but helps if
you're using short-lived processes.</p>
</div>
</div>








<div class="comment" data-comment-id="6154">
  <header>

    </header><h5>Damien</h5>

  <p class="time">#6154, <span title="2008-08-23T16:21:43Z" class="iso8601">12 days later</span></p>
  
  <div class="comment-body"><p>Shouldn't attrproperty return property(_Object)?</p>
</div>
</div>








<div class="comment" data-comment-id="6168">
  <header>

    </header><h5><a href="http://www.appoil.com/">sean</a></h5>

  <p class="time">#6168, <span title="2008-08-23T21:51:48Z" class="iso8601">12 days later</span></p>
  
  <div class="comment-body"><p>quite a useful tutorial, i finally understand what the property is doing now, thanks!</p>
</div>
</div>








<div class="comment" data-comment-id="6174">
  <header>

    </header><h5><a href="http://www.railsenvy.com/">Jason Seifer</a></h5>

  <p class="time">#6174, <span title="2008-08-24T01:23:36Z" class="iso8601">12 days later</span></p>
  
  <div class="comment-body"><p>Coming
from a rails background this is thought provoking because in rails you
wouldn't make a url part of your model code. However you could make the
argument for it, especially how you demonstrate it, that doing it this
way makes more sense -- the url for book reviews is _part of_ the
domain model of the book. Great post, thank you for writing this. </p>
</div>
</div>








<div class="comment" data-comment-id="6187">
  <header>

    </header><h5>onno</h5>

  <p class="time">#6187, <span title="2008-08-24T04:06:20Z" class="iso8601">13 days later</span></p>
  
  <div class="comment-body"><p>What about a RSS feed so I can follow your articles</p>
</div>
</div>








<div class="comment" data-comment-id="6210">
  <header>

    </header><h5><a href="http://adam.gomaa.us/">Adam Gomaa</a></h5>

  <p class="time">#6210, <span title="2008-08-24T10:22:00Z" class="iso8601">13 days later</span></p>
  
  <div class="comment-body"><p>Damien: Yes, thanks for the heads-up.</p>

<p>onno: For some reason I only had the RSS link on the blog index page; it should be fixed now.</p>
</div>
</div>








<div class="comment" data-comment-id="7464">
  <header>

    </header><h5><a href="http://blog.michaeltrier.com/">Empty</a></h5>

  <p class="time">#7464, <span title="2008-09-11T16:39:06Z" class="iso8601">4 weeks later</span></p>
  
  <div class="comment-body"><p>Excellent
stuff Adam. You're one smart guy. I really like the
instance.urls.action approach. That said I disagree with Jason. My
feeling is that the routes can know about the models but not the other
way around.</p>
</div>
</div>




</div>

</div>

</body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><title>Pygtk MVC | Main / Examples browse</title>


  
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="index.php_files/pmwiki.css" type="text/css"><!--HeaderText-->
  <style type="text/css"><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  .editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style>  <meta name="robots" content="index,follow"></head><body>
<!--PageHeaderFmt-->
  <div id="wikilogo"><a href="http://pygtkmvc.sourceforge.net/index.php"><img src="index.php_files/logo.jpg" alt="Pygtk MVC" border="0"></a></div>
  <div id="wikihead">
  </div>
<!--/PageHeaderFmt-->
  <table id="wikimid" cellpadding="0" cellspacing="0" width="100%"><tbody><tr>
<!--PageLeftFmt-->
      <td id="wikileft" valign="top">
        <h1>Pygtk MVC</h1>
<ul><li><a class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.WhatIsIt">About It</a>
</li><li><a class="urllink" href="http://sourceforge.net/news/?group_id=123428" rel="nofollow">News</a>
</li><li><a class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Features">Features</a>
</li><li><a class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Motivations">Motivations</a>
</li><li><a class="urllink" href="https://sourceforge.net/projects/pygtkmvc" rel="nofollow">Project Summary</a>
</li></ul><div class="vspace"></div><h1>Documentation</h1>
<ul><li><a class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.License">License</a>
</li><li><a class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Documentation">Documentation</a>
</li><li><a class="selflink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples">Examples</a>
</li></ul><div class="vspace"></div><h1>Download</h1>
<ul><li><a class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.DownloadPage">Download Page</a>
</li></ul>
</td>
<!--/PageLeftFmt-->
      <td id="wikibody" valign="top">
        <div id="wikicmds"><ul><li class="browse"><a accesskey="" class="selflink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples">View</a>
</li><li class="edit"><a accesskey="e" rel="nofollow" class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples?action=edit">Edit</a>
</li><li class="diff"><a accesskey="h" rel="nofollow" class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples?action=diff">History</a>
</li><li class="print"><a accesskey="" rel="nofollow" class="wikilink" href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples?action=print">Print</a>
</li></ul>
</div>
<!--PageTitleFmt-->
        <div id="wikititle">
          <div class="pagegroup"><a href="http://pygtkmvc.sourceforge.net/index.php?n=Main">Main</a> /</div>
          <h1 class="pagetitle">Examples</h1></div>
<!--PageText-->
<div id="wikitext">
<p>This is a very simple example that can be used to easily understand
this provided Model-View-Controller implementation. The full source code is provided by the distributed source package. 
</p>
<div class="vspace"></div><hr>
<p>Note that the provided documentation and tutorial provide more extensive information. 
</p>
<p class="vspace"><span style="font-size: 120%;"><strong>Important</strong></span> Source distribution contains a larger and more complete set of examples you may be interested in looking at.
</p><hr>
<p class="vspace">In this example, a window containing a label and a button is presented to the user. 
</p>
<div class="vspace"></div><pre> <img src="index.php_files/screeenshot.html" alt="" title=""> 
</pre><p class="vspace">Through the label the user can see a message
taken from a set of possible messages. By pressing the button the user
can see another message. </p>
<p class="vspace">The key idea is that by pressing the button, the user
will change an observable property within the model. All the pairs of
controller/view connected to that model that are interested in
observing that property will be automatically notified when the
property change, independently on why and how it changed. </p>
<p class="vspace">The sample application is constituted by 4 parts:
</p><ol><li>The main program (<em>example.py</em>)
</li><li>MVC framework, provided by the user (<em>my_model.py</em>, <em>ex_view.py</em>, <em>ex_ctrl.py</em>)
</li><li>MVC services, prvided by the module <em>gtkmvc</em>
</li><li>The xml representation of the view, generated by Glade
</li></ol><div class="vspace"></div><h2>example.py:</h2>
<p><em>example.py</em> simply instantiates three classes (model, view, controller) provided by the MVF Framework, and then runs the gtk mainloop. 
</p>
<div class="vspace"></div><pre class="sourcecode"><font color="blue">from</font> my_model <font color="blue">import</font> ExampleModel
<font color="blue">from</font> my_ctrl  <font color="blue">import</font> ExampleController
<font color="blue">from</font> my_view  <font color="blue">import</font> ExampleView
<font color="blue">import</font> gtk

<font color="blue">def</font> main():
    model = ExampleModel()
    ctrl  = ExampleController(model)
    view  = ExampleView(ctrl)

    <font color="green"># Starts the GTK toolkit:</font>
    gtk.main()
    <font color="blue">return</font>

<font color="blue">if</font> __name__ == '__main__':
    main()
</pre>
<div class="vspace"></div><h2>MVC Framework</h2>
<p>Contains three classes: Example{Model,View,Controller}. Each of them 
derives from the corresponding class provided by the <em>gtkmvc</em> module
</p>
<div class="vspace"></div><h3>ExampleModel</h3>
<p>Contains the application data: a set of messages, and an
observable property which represents the current message in the set.
By using metaclasses, it is extremely easy to add and use properties
within a model.  
</p>
<div class="vspace"></div><pre class="sourcecode"><font color="blue">from</font> gtkmvc <font color="blue">import</font> Model

<font color="blue">class</font> ExampleModel (Model):
    <font color="green"># Observable properties that Observers are interested in observing</font>
    __properties__ = {
        "message_index" : -1  <font color="green"># initial value</font>
        }

    <font color="blue">def</font> <font color="blue">__init__</font>(self):
        Model.<font color="blue">__init__</font>(self)

        self.messages= ('Initial message',
                        'Another message', 
                        'A third message...',
                        'Model changed again')
        <font color="blue">return</font>

    <font color="blue">def</font> get_message(self, index): <font color="blue">return</font> self.messages[index]

    <font color="blue">def</font> set_next_message(self):
        <font color="green"># this changes the observable property:</font>
        self.message_index = (self.message_index + 1) % <font color="blue">len</font>(self.messages)
        <font color="blue">return</font>

    <font color="blue">pass</font> <font color="green"># end of class</font>
</pre>
<div class="vspace"></div><h3>ExampleView</h3>
<p>It shows the current message in the model, as well as the
message length. It also provides a button. The GUI is built by using
Glade, and the generated xml representation is dynamically loaded
by the view itself. All the GUI-related events are automatically
searched and linked by the view, and they are connected to the associated
controller.
</p>
<div class="vspace"></div><pre class="sourcecode"><font color="blue">from</font> gtkmvc.view <font color="blue">import</font> View

<font color="blue">import</font> os.path

GLADE_NAME = "example.glade"
GLADE_PATH = "./glade" 
GLADE = os.path.join(GLADE_PATH, GLADE_NAME)

<font color="blue">class</font> ExampleView (View):
    """The application view. Contains only the main window1 tree."""

    <font color="blue">def</font> <font color="blue">__init__</font>(self, controller):
        """Contructor, takes the controller instance to perform registration"""
        View.<font color="blue">__init__</font>(self, controller, GLADE, "window1")

        <font color="blue">return</font>
    <font color="blue">pass</font> <font color="green"># end of class</font>
</pre>
<div class="vspace"></div><h3>ExampleController </h3>
<p>Provides two services: 
</p><ul><li>A method which is automatically linked to the ExampleView's button <em>clicked</em> event. The automatic binding is performed at runtime, when the view is being contructed. 
<div class="vspace"></div></li><li>A method to get the model's
observable property change notifications. Since ExampleController is
also an observer for the associated model, it will be notified each
time the observable property changes. </li></ul><div class="vspace"></div><pre class="sourcecode">
<font color="blue">import</font> gtk

<font color="blue">class</font> ExampleController (Controller):
    """The only one controller. Handles the button clicked signal, <font color="blue">and</font>
    notifications about one observable property."""

    <font color="blue">def</font> <font color="blue">__init__</font>(self, model):
        """Contructor. model will be accessible via the member 'self.model'.
        Registration <font color="blue">is</font> also performed."""
        Controller.<font color="blue">__init__</font>(self, model)
        <font color="blue">return</font>

    <font color="blue">def</font> register_view(self, view):
        Controller.register_view(self, view) <font color="green"># Calls the overloaded method</font>

        <font color="green"># Connects the exiting signal:</font>
        view.get_top_widget().connect("destroy", gtk.main_quit)
        <font color="blue">return</font>

    <font color="green"># Signal</font>
    <font color="blue">def</font> on_button1_clicked(self, button):
        """Handles the signal clicked <font color="blue">for</font> button1. Changes the model."""
        self.model.set_next_message()
        <font color="blue">return</font>

    <font color="green"># Observables notifications:</font>
    <font color="blue">def</font> property_message_index_value_change(self, model, old, new):
        """The model <font color="blue">is</font> changed <font color="blue">and</font> the view must be updated"""

        <font color="blue">print</font> "Controller: property 'message_index' changed"
        msg = model.get_message(new)

        self.view['label_text'].set_text(msg)
        self.view['label_text_len'].set_text(<font color="blue">str</font>(<font color="blue">len</font>(msg)))
        <font color="blue">return</font>

    <font color="blue">pass</font> <font color="green"># end of class</font>
</pre>
</div>

      </td>
    </tr></tbody></table>
<!--PageFooterFmt-->
  <div id="wikifoot">
    <div class="footnav">
      <a href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples?action=edit">Edit</a> -
      <a href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples?action=diff">History</a> -
      <a href="http://pygtkmvc.sourceforge.net/index.php?n=Main.Examples?action=print" target="_blank">Print</a> -
      <a href="http://pygtkmvc.sourceforge.net/index.php?n=Main.RecentChanges">Recent Changes</a> -
      <a href="http://pygtkmvc.sourceforge.net/index.php?n=Site.Search">Search</a></div>
    <div class="lastmod">Page last modified on May 22, 2007, at 08:53 AM</div></div>
<!--/PageFooterFmt-->

</body></html>